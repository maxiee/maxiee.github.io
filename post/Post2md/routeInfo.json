{"template":"/home/maxiee/Code/Blog/maxiee.github.io/src/pages/post","sharedHashesByProp":{},"data":{"post":{"name":"单页应用接入 Google Analytics 跟踪笔记","desc":"本站是一个单页应用 (SPA), 它的跟踪方法与传统方法有所区别, Google Analytics 支持跟踪单页应用, 本文是对接入过程的记录与总结.","type":"md","link":"Post2md","create":"2018-02-22","filename":"Post2.md"},"content":"## 前言\n\n统计是网站的基础功能，通过统计我们可以了解用户对网站、产品的使用情况，进而进行更好的运营。对于传统网站，只需要在网页中插入一段 JavaScript 脚本，即可实现统计。对于单页应用（SPA），该如何做统计呢？Google Analytics 提供了一套 API 进行了支持。\n\n本文中介绍如何在 React SPA 中进行统计。\n\n## analytics.js\n\nanalytics.js 是一个库, 通过与 Google Analytics 通信, 实现跟踪.\n\n## react-ga/react-ga\n\n这个库是对 analytics.js 的 React 封装. 有了这个库, 就可以方便地在 React 单页应用中进行跟踪埋点了.\n\n依赖安装：\n\n```\nnpm install react-ga --save\n```\n\n## 初始化\n\n通过下面代码进行初始化:\n\n``` js\nimport ReactGA from 'react-ga';\nReactGA.initialize('UA-000000-01');\n```\n\n## 记录一次访问\n\n通过 pageview 方法记录一次页面访问：\n\n``` js\nReactGA.pageview(window.location.pathname + window.location.search);\n```\n\n## ReactGA API\n\n除了 pageview，ReactGA 提供了很丰富的功能：\n\n|方法|功能|\n|---|---|\n|pageview|统计页面访问（URL 变了）|\n|modalview|统计弹层访问（URL 没变）|\n|event|统计交互事件|\n|timing|统计时长|\n\n## react-ga 与 React Router v4 整合\n\n我在项目中使用 React Router v4 进行路由, 如何实现路径跟踪呢?我的第一想法是将 react-ga 与 React Router v4 整合.\n\n参考文献 5 已经实现了这一整合的方案.\n\n具体实现方法是创建一个响应所有 route 的组件:\n\n```jsx\nclass Analytics extends React.Component<RouteComponentProps<any>> {\n    componentDidMount() {\n      this.sendPageChange(\n        this.props.location.pathname,\n        this.props.location.search)\n    }\n  \n    componentDidUpdate(prevProps: RouteComponentProps<any>) {\n      if (this.props.location.pathname\n        !== prevProps.location.pathname\n        || this.props.location.search !== prevProps.location.search) {\n        this.sendPageChange(\n          this.props.location.pathname,\n          this.props.location.search)\n      }\n    }\n  \n    sendPageChange(pathname: string, search: string = \"\") {\n      const page = pathname + search\n      ReactGA.set({page});\n      ReactGA.pageview(page);\n    }\n  \n    render() {\n      return null\n    }\n  }\n  \n  const AnalyticsTracker = () => {\n    return <Route component={Analytics} />\n  }\n  \n  // ...further down the file:\n  <BrowserRouter>\n    <AnalyticsTracker />\n    <Switch>\n    <Route exact={true} path=\"/\" component={HomePage} />\n    // ...\n```\n\n这样, 每次路由跳转到一个新的页面, 都会进行 Google Analytics 路径跟踪.\n\n## 参考文献\n\n- [Google Analytics 首页](https://analytics.google.com/)\n- [Google Analytics 文档: 单页应用跟踪](https://developers.google.com/analytics/devguides/collection/analyticsjs/single-page-applications?hl=zh-cn)\n- [Google Analytics 文档: 将 analytics.js 添加到网站中](https://developers.google.com/analytics/devguides/collection/analyticsjs/?hl=zh-cn)\n- [react-ga/react-ga](https://github.com/react-ga/react-ga)\n- [react-ga 与 React Router V4 的整合](https://github.com/react-ga/react-ga/issues/122)\n"},"path":"post/Post2md"}
