{"template":"/home/maxiee/Code/Blog/maxiee.github.io/src/pages/post","sharedHashesByProp":{},"data":{"post":{"name":"家庭NAS：从 calibre-webserver 迁移到 Calibre-web","desc":"使用 calibre-webserver 一段时间后，发现它更新不太活跃，而另一个项目 Calibre-web 更新活跃，于是考虑迁移到后者。因为两个项目都是对 Calibre 进行套壳，底层数据库是一样的，理论上是可行的。在本文中通过实践探索，成功实现迁移。\n","type":"md","link":"calibrewebmd","create":"2021-02-06","filename":"calibreweb.md"},"content":"## 前言\n\n使用 calibre-webserver 一段时间后，发现它更新不太活跃，而另一个项目 Calibre-web 更新活跃，于是考虑迁移到后者。因为两个项目都是对 Calibre 进行套壳，底层数据库是一样的，理论上是可行的。在本文中通过实践探索，成功实现迁移。\n\n## 镜像选择\n\n社区里有很多 Calibre-web 镜像：\n\nlinuxserver/calibre-web\n\n* 10M+ Downloads 348 Stars\n* Updated 3 days ago\n\ntechnosoft2000/calibre-web\n\n* 10M+ Downloads 144 Stars\n* Updated 3 months ago\n\n这里选择 calibre-web，依据是 star 更多、更新更频繁。\n\n## calibre-web\n\ncalibre-web 项目[首页](https://github.com/janeczku/calibre-web)。\n\n这个项目的突出特色：\n\n* OPDS Feed，阅读器链接时比较友好\n* Create a custom book collection (shelves)\n* Upload new books in many formats, including audio formats (.mp3, .m4a, .m4b)\n\n## 迁移方案\n\n这里想到一个更加稳妥的方案：\n\n* 先为 calibre-web 建立全新目录，让其进行初始化\n* 之后比较 calibre-web 与 calibre-webserver 两个目录的特点\n* 找到 Calibre 数据库，并将老数据库**复制**到新位置\n* 之所以选择复制，能够保证老数据库还是好用的\n* 待 calibre-web 部署完成后，可将老工程停掉，但保留数据一段时间，防止新数据库出问题\n* 等 calibre-web 确认正常之后，再将老数据库删除\n\n## 迁移方案实践\n\n之后 ssh 登陆到 NAS 上，创建对应目录：\n\n```\n// 主目录\n/srv/dev-disk-by-uuid-a451ce1f-eaad-4831-844f-00d2d611536c/hd1_bk/calibre-web-data\n\n// config\n/srv/dev-disk-by-uuid-a451ce1f-eaad-4831-844f-00d2d611536c/hd1_bk/calibre-web-data/config\n\n// books\n/srv/dev-disk-by-uuid-a451ce1f-eaad-4831-844f-00d2d611536c/hd1_bk/calibre-web-data/books\n```\n\n执行 Docker 命令：\n\n```\ndocker run -d \\\n  --name=calibre-web \\\n  -e PUID=1000 \\\n  -e PGID=1000 \\\n  -e TZ=Asia/Shanghai \\\n  -p 8083:8083 \\\n  -v /srv/dev-disk-by-uuid-a451ce1f-eaad-4831-844f-00d2d611536c/hd1_bk/calibre-web-data/config:/config \\\n  -v /srv/dev-disk-by-uuid-a451ce1f-eaad-4831-844f-00d2d611536c/hd1_bk/calibre-web-data/books:/books \\\n  --restart unless-stopped \\\n  ghcr.io/linuxserver/calibre-web\n```\n\n这个镜像托管在 ghcr.io 上，拉取速度非常慢。\n\n## 站点配置\n\n书库配置，设置地址为 /books。\n\n此时会报错【数据库路径无效，请输入正确的路径】，原因是我们挂载的 books 目录是一个空目录，找不到 metadata.db。\n\n![](image/截屏2021-02-06下午2.57.45.png)\n\n解决方法是把 calibre-webserver 的书库复制过去。\n\ncalibre-webserver 的书库位于 library 下，复制到 calibre-web 的 books 目录下。\n\n之后再配置，说数据库不可写入：\n\n![](image/截屏2021-02-06下午4.28.45.png)\n\n调整一下 meatadata 权限即可。\n\n下一步登录，默认用户为 admin 密码为 admin123。\n\n登录进去之后，能看到电子书加载正常。\n\n## 小结\n\n体验了一番 calibre-web 后，我发现它的功能确实要比 calibre-webserver，并且维护更加积极，这也表明未来会有更加丰富的功能被引入，不得不说这波折腾非常值了。\n\n## 网络资源\n\n* [威联通折腾篇十九：Calibre-web](http://einverne.github.io/post/2020/02/qnap-calibre-web.html)\n* [https://www.jianshu.com/p/66c160ee6677](https://www.jianshu.com/p/66c160ee6677)\n* [群晖 Docker 部署 Calibre Web 打造全功能书库](https://www.zhyong.cn/posts/fcef/)\n"},"path":"post/calibrewebmd"}
