{"template":"/home/maxiee/Code/Blog/maxiee.github.io/src/pages/post","sharedHashesByProp":{},"data":{"post":{"name":"React Native ä»£ç é˜…è¯»ï¼ˆåäºŒï¼‰ï¼šYoga åº•å±‚å¸ƒå±€åº“(Android)","desc":"React Native å¹¶æ²¡æœ‰ä½¿ç”¨ Android åŸç”Ÿçš„å¸ƒå±€å¼•æ“ï¼Œè€Œæ˜¯ä½¿ç”¨äº† Facebook çš„ Yoga å¸ƒå±€å¼•æ“ã€‚Yoga å¼•æ“æ˜¯è·¨å¹³å°çš„ï¼Œå®ƒå®ç°äº† Flexbox å¸ƒå±€æ¨¡å¼ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ React Native çš„åº•å±‚å¸ƒå±€å¼•æ“ Yogaã€‚","type":"md","link":"ReactNativeCode12md","create":"2019-03-26","filename":"ReactNativeCode12.md"},"content":"## å‰è¨€\n\nReact Native å¹¶æ²¡æœ‰ä½¿ç”¨ Android åŸç”Ÿçš„å¸ƒå±€å¼•æ“ï¼Œè€Œæ˜¯ä½¿ç”¨äº† Facebook çš„ [Yoga](https://github.com/facebook/yoga) å¸ƒå±€å¼•æ“ã€‚Yoga å¼•æ“æ˜¯è·¨å¹³å°çš„ï¼Œå®ƒå®ç°äº† Flexbox å¸ƒå±€æ¨¡å¼ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ React Native çš„åº•å±‚å¸ƒå±€å¼•æ“ Yogaã€‚\n\nå…³äºæœ¬æ–‡çš„å®ä¾‹ä»£ç è¯·å‚è§ [MaxieeRNLab](https://github.com/maxiee/MaxieeRNLab) çš„ [YogaActivity](https://github.com/maxiee/MaxieeRNLab/blob/master/android/app/src/main/java/com/maxieernlab/yoga/YogaActivity1.java)ã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªé¡¹ç›®æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ Starï¼\n\n## Yoga å¸ƒå±€ä¸ Android åŸç”Ÿå¸ƒå±€çš„ä¸åŒ\n\nåœ¨æœ€åˆè§£é™¤ Yoga çš„æ—¶å€™ï¼Œå®Œå…¨æä¸æ‡‚å®ƒæ˜¯æ€ä¹ˆæ¥è¿›è¡Œå¸ƒå±€çš„ã€‚åŸå› æ˜¯æˆ‘å¯¹ Android å¸ƒå±€çš„æ¦‚å¿µå…ˆå…¥ä¸ºä¸»äº†ã€‚\n\né¦–å…ˆéœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒYoga æ˜¯ä¸€å¥—å®Œå…¨ç‹¬ç«‹çš„å¸ƒå±€å¼•æ“ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´å®ƒæ²¡æœ‰ç”¨åˆ° Android çš„å¸ƒå±€é€»è¾‘ã€‚\n\nä¸ºäº†å®Œæˆè¿™ä¸ªæ€ç»´è½¬å˜ï¼Œè®©æˆ‘ä»¬å…ˆæƒ³æƒ³ Android åŸç”Ÿæ˜¯å¦‚ä½•å¸ƒå±€çš„ï¼Ÿ\n\næˆ‘ä»¬å¯èƒ½ä¼šå†™å¦‚ä¸‹çš„å¸ƒå±€ï¼š\n\n```xml\n<LinearLayout\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\">\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Hello World!\"/>\n</LinearLayout>\n```\n\nåœ¨å†™ä¸‹è¿™æ®µå¸ƒå±€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å·²ç»åœ¨ä½¿ç”¨ Android åŸç”Ÿçš„å¸ƒå±€é€»è¾‘äº†ï¼š\n\n- é¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª LinearLayoutï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿æ€§å®¹å™¨å¸ƒå±€ï¼Œæˆ‘ä»¬æŒ‡å®šå®ƒçš„å¤§å°ç­–ç•¥ä¸ºæ¨ªå‘å……æ»¡ï¼Œçºµå‘åŒ…è£¹å†…å®¹ï¼Œæ²¿ç«–å‘è¿›è¡Œæ’åˆ—\n- åœ¨ LinearLayout åŒ…å«æœ‰ä¸€ä¸ªæ¨ªçºµéƒ½åŒ…è£¹å†…å®¹çš„ TextView\n- è¿™ä¸ªå¸ƒå±€åœ¨è¿è¡Œæ—¶ï¼ŒAndroid åŸç”Ÿçš„å¸ƒå±€å¼•æ“ä¼šéå†å¸ƒå±€ï¼Œæ ¹æ®æ§ä»¶çš„å¤§å°ç­–ç•¥æ¥è¿›è¡Œ onMeasureã€onLayout æ“ä½œ\n- è¿™ä¸ªè¿‡ç¨‹æ˜¯ Android å¼€å‘çš„åŸºæœ¬åŠŸï¼Œä¹Ÿæ˜¯é¢è¯•çš„å¸¸è€ƒå†…å®¹\n\nä½†æ˜¯åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ Yoga å¼•æ“æ¥æ›¿æ¢ Android åŸç”Ÿçš„å¸ƒå±€å¼•æ“ï¼Œå› æ­¤ä¸Šé¢çš„è¿™äº›çŸ¥è¯†å…¨éƒ¨**ä¸ä¼š**ç”¨åˆ°ï¼æˆ‘ä»¬éœ€è¦å°†è®¤çŸ¥æ¸…ç©ºã€‚\n\n## ç”¨ Yoga è¿›è¡Œå¸ƒå±€\n\næ¸…ç©ºåˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿç°åœ¨å±å¹•ä¸Šåªæœ‰ä¸€ä¸ªåæ ‡ç³»ã€‚å‡è®¾æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª TextViewï¼Œå¦‚ä½•å°†å®ƒæ‘†åˆ°æŒ‡å®šä½ç½®å‘¢ï¼Ÿé€šè¿‡å‘å®ƒæŒ‡å®š xã€y åæ ‡ã€‚\n\nYoga å¸ƒå±€å¼•æ“å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°å€¼è®¡ç®—å¼•æ“ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸ UI è§†å›¾æ— å…³çš„ã€‚\n\nåœ¨ Yoga ä¸­ï¼Œå¸ƒå±€çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹(YogaNode)ï¼Œè¿™ä¸ª YogaNode ä¼šä»£è¡¨ç•Œé¢ä¸Šçš„æŸä¸ªå…ƒç´ ï¼ˆæ¯”å¦‚ä¸€ä¸ª TextViewï¼‰ï¼Œä½†æ˜¯ä¸¤è€…æ²¡æœ‰ç›´æ¥å…³è”ã€‚\n\næ¯”å¦‚å‡è®¾æˆ‘ä»¬è¦åœ¨å±å¹•ä¸Šæ¨ªå‘å±•ç¤ºä¸‰ä¸ªæ–¹å—ï¼Œå¯¹åº”çš„[ä»£ç ](https://github.com/maxiee/MaxieeRNLab/blob/master/android/app/src/main/java/com/maxieernlab/yoga/YogaActivity2.java)å¦‚ä¸‹(Activity çš„ onCreate æ–¹æ³•ï¼‰:\n\n```java\nFrameLayout container = new FrameLayout(this);\n\n/**\n * å¸ƒå±€çº¯æ•°å€¼è®¡ç®—\n */\nfloat screenWidth = getWindowManager().getDefaultDisplay().getWidth();\nfloat screenHeight = getWindowManager().getDefaultDisplay().getHeight();\n\nYogaNode root = new YogaNode();\nroot.setWidth(screenWidth);\nroot.setHeight(screenHeight);\nroot.setFlexDirection(YogaFlexDirection.ROW);\n\nYogaNode rect1 = new YogaNode();\nrect1.setHeight(VIEW_WIDTH);\nrect1.setWidth(VIEW_WIDTH);\nrect1.setMargin(YogaEdge.ALL, 20);\n\nYogaNode rect2 = new YogaNode();\nrect2.setHeight(VIEW_WIDTH);\nrect2.setWidth(VIEW_WIDTH);\nrect2.setMargin(YogaEdge.ALL, 20);\n\nYogaNode rect3 = new YogaNode();\nrect3.setHeight(VIEW_WIDTH);\nrect3.setWidth(VIEW_WIDTH);\nrect3.setMargin(YogaEdge.ALL, 20);\n\nroot.addChildAt(rect1, 0);\nroot.addChildAt(rect2, 1);\nroot.addChildAt(rect3, 2);\n\n// ç»™å®šå±å¹•é•¿å®½ï¼Œæ±‚è§£å±å¹•å…ƒç´ ä½ç½®\nroot.calculateLayout(screenWidth, screenHeight);\n\n/**\n * Android è§†å›¾åˆ›å»ºäºå®šä½\n */\nViewGroup.LayoutParams lp = new FrameLayout.LayoutParams(VIEW_WIDTH, VIEW_WIDTH);\n\nView v1 = new View(this);\nv1.setLayoutParams(lp);\nv1.setBackgroundColor(Color.parseColor(\"#d50000\"));\n\nView v2 = new View(this);\nv2.setLayoutParams(lp);\nv2.setBackgroundColor(Color.parseColor(\"#ff1744\"));\n\nView v3 = new View(this);\nv3.setLayoutParams(lp);\nv3.setBackgroundColor(Color.parseColor(\"#ff5252\"));\n\ncontainer.addView(v1);\ncontainer.addView(v2);\ncontainer.addView(v3);\n\nv1.setX(rect1.getLayoutX());\nv1.setY(rect1.getLayoutY());\nv2.setX(rect2.getLayoutX());\nv2.setY(rect2.getLayoutY());\nv3.setX(rect3.getLayoutX());\nv3.setY(rect3.getLayoutY());\n\nsetContentView(container);\n```\n\nå…¶ä¸­ï¼š\n\n- æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šYoga å¼•æ“å¸ƒå±€çº¯æ•°å€¼è®¡ç®—ã€Android è§†å›¾åˆ›å»ºäºå®šä½\n- å…¶ä¸­ YogaNode å®Œå…¨æ˜¯è„±ç¦» Android View ä½“ç³»çš„ï¼Œä¸¤è€…åªè¦ä¿æŒæ¦‚å¿µä¸Šçš„ä¸€è‡´(ä¸€ä¸ªæ§ä»¶çš„ Flexbox å®šä¹‰å¥½ã€YogaNode è®¾ç½®å¤šä¹ˆå¤§ï¼Œè§†å›¾æ§ä»¶ä¹Ÿè¦è®¾ç½®å¤šä¹ˆå¤§ï¼Œä¸¤è€…ä¿æŒä¸€è‡´)\n- å­¦ä¹ äº† React Native åº•å±‚çš„ Yoga å¸ƒå±€å¼•æ“ä¹‹åï¼Œæˆ‘ä»¬å†å›å¤´çœ‹ RN çš„ Shadow Node è¿™ä¸ªæ¦‚å¿µï¼Œå°±ä¼šæœ‰æ›´å¥½çš„ç†è§£äº†\n\nè¿™æ®µä»£ç æ‰§è¡Œï¼ˆclone [MaxieeRNLab](https://github.com/maxiee/MaxieeRNLab) åç¼–è¯‘å‚è§æ•ˆæœï¼‰çš„æ•ˆæœå¦‚ä¸‹ï¼š\n\n![](image/ReactNativeCode1201.png)\n\n## æ›´å¤æ‚ä¸€ç‚¹çš„ä¾‹å­\n\næœ‰äº†ä¸Šä¸€èŠ‚çš„åŸºç¡€åï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´å¤æ‚ä¸€äº›çš„ä¾‹å­([å®Œæ•´ä»£ç ](https://github.com/maxiee/MaxieeRNLab/blob/master/android/app/src/main/java/com/maxieernlab/yoga/YogaActivity1.java))ï¼š\n\n```java\npackage com.maxieernlab.yoga;\n\nimport android.graphics.Color;\nimport android.os.Bundle;\nimport android.support.annotation.Nullable;\nimport android.support.v7.app.AppCompatActivity;\nimport android.util.Log;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.FrameLayout;\n\nimport com.facebook.yoga.YogaEdge;\nimport com.facebook.yoga.YogaFlexDirection;\nimport com.facebook.yoga.YogaNode;\n\nimport java.util.ArrayList;\n\npublic class YogaActivity1 extends AppCompatActivity {\n    private static final int VIEW_WIDTH = 200;\n\n    private float screenHeight;\n    private float screenWidth;\n\n    private ArrayList<View> poolView = new ArrayList<>();\n    private ArrayList<YogaNode> poolNode = new ArrayList<>();\n\n    private String[][] colors = new String[][] {\n            new String[] { \"#d50000\", \"#ff1744\", \"#ff5252\", \"#ff8a80\" },\n            new String[] { \"#c51162\", \"#f50057\", \"#ff4081\", \"#ff80ab\" },\n            new String[] { \"#aa00ff\", \"#d500f9\", \"#e040fb\", \"#ea80fc\" },\n            new String[] { \"#6200ea\", \"#651fff\", \"#7c4dff\", \"#b388ff\" }\n    };\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        FrameLayout container = new FrameLayout(this);\n\n        screenWidth = getWindowManager().getDefaultDisplay().getWidth();\n        screenHeight = getWindowManager().getDefaultDisplay().getHeight();\n        log(\"Screen size = (%f, %f)\", screenWidth, screenHeight);\n\n        YogaNode root = new YogaNode();\n        root.setWidth(screenWidth);\n        root.setHeight(screenHeight);\n        root.setFlexDirection(YogaFlexDirection.COLUMN);\n\n        log(\"start\");\n        createRow1(root, 0);\n        createRow1(root, 1);\n        createRow1(root, 2);\n        createRow1(root, 3);\n\n        root.calculateLayout(screenWidth, screenHeight);\n\n        for (int i = 0; i < poolView.size(); i++) {\n            View v = poolView.get(i);\n            YogaNode n = poolNode.get(i);\n            YogaNode r = n.getOwner();\n            v.setX(r.getLayoutX() + n.getLayoutX());\n            v.setY(r.getLayoutY() + n.getLayoutY());\n            log(\"v%d position=(%f, %f)\",\n                    i,\n                    r.getLayoutX() + n.getLayoutX(),\n                    r.getLayoutY() + n.getLayoutY());\n            container.addView(v);\n        }\n\n        log(\"end\");\n\n        setContentView(container);\n    }\n\n    private void createRow1(YogaNode root, int index) {\n        log(\"create index = \" + index);\n        YogaNode row = new YogaNode();\n        row.setHeight(VIEW_WIDTH);\n        row.setWidth(VIEW_WIDTH * 4);\n        row.setFlexDirection(YogaFlexDirection.ROW);\n        row.setMargin(YogaEdge.ALL, 20);\n\n        for (int i = 0; i < 4; i++) {\n            YogaNode n = new YogaNode();\n            n.setWidth(VIEW_WIDTH);\n            n.setHeight(VIEW_WIDTH);\n            View v = createView(colors[index][i]);\n            row.addChildAt(n, i);\n            poolNode.add(n);\n            poolView.add(v);\n        }\n\n        root.addChildAt(row, index);\n    }\n\n    private View createView(String color) {\n        View v = new View(this);\n        v.setBackgroundColor(Color.parseColor(color));\n        ViewGroup.LayoutParams lp = new FrameLayout.LayoutParams(VIEW_WIDTH, VIEW_WIDTH);\n        v.setLayoutParams(lp);\n        return v;\n    }\n\n    private void log(String template, Object... objects) {\n        Log.d(\"max-yoga\", String.format(template, objects));\n    }\n}\n```\n\næ•ˆæœå›¾å¦‚ä¸‹ï¼š\n\n![](image/ReactNativeCode1202.png)\n\nå…¶ä¸­ï¼š\n\n- éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¯¹äºåµŒå¥—çš„ Nodeï¼Œå®ƒçš„ getLayoutX å’Œ getLayoutY æ˜¯ç›¸å¯¹äºä¸Šçº§ Node è€Œè¨€çš„\n- å› æ­¤å¦‚æœè¦å¾—åˆ° Node åœ¨å±å¹•ä¸Šçš„ç»å¯¹åæ ‡ï¼Œéœ€è¦ç´¯åŠ å®ƒæ‰€æœ‰çˆ¶çº§çš„åæ ‡\n\n## å°ç»“\n\nè‡³æ­¤æˆ‘ä»¬å°±å®Œæˆäº†å¯¹ React Native åº•å±‚å¸ƒå±€å¼•æ“ Yoga çš„å­¦ä¹ ã€‚\n\næœ‰äº†è¿™ä¸€åŸºç¡€ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬å°±å¯ä»¥å‘ React Native çš„ UI éƒ¨åˆ†å‘èµ·è¿›æ”»äº†ï¼ğŸ˜†"},"path":"post/ReactNativeCode12md"}
