{"template":"/home/maxiee/Code/Blog/maxiee.github.io/src/pages/post","sharedHashesByProp":{},"data":{"post":{"name":"ReactRPG ä»£ç é˜…è¯»ä¹‹ Redux æ•°æ®å±‚è®¾è®¡","desc":"ReactRPG æ˜¯ä¸€ä¸ªç”¨ React å¼€å‘çš„åœ°ç‰¢æ¢é™©æ¸¸æˆï¼Œè¿™æ˜¯ä¸€ä»½å¾ˆå¥½çš„ Reactã€Redux å­¦ä¹ èµ„æºã€‚åœ¨æœ¬æˆ‘ä¸­æˆ‘ä»¬å­¦ä¹ å®ƒçš„ Redux æ•°æ®ç»“æ„å®ç°ã€‚é€šè¿‡æ¸¸æˆå­¦ä¹  Reduxï¼Œæ˜¯å¾ˆå¥½ç©çš„ä½“éªŒã€‚","type":"md","link":"ReactRPG1md","create":"2019-03-19","filename":"ReactRPG1.md"},"content":"## å‰è¨€\n\nReactRPG æ˜¯ä¸€ä¸ªç”¨ React å¼€å‘çš„åœ°ç‰¢æ¢é™©æ¸¸æˆï¼Œè¿™æ˜¯ä¸€ä»½å¾ˆå¥½çš„ Reactã€Redux å­¦ä¹ èµ„æºã€‚åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬å­¦ä¹ å®ƒçš„ Redux æ•°æ®ç»“æ„å®ç°ã€‚é€šè¿‡æ¸¸æˆå­¦ä¹  Reduxï¼Œæ˜¯å¾ˆå¥½ç©çš„ä½“éªŒã€‚\n\nå¦‚æœä½ ä¸çŸ¥é“ ReactRPG æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆå‚è§ä¹‹å‰çš„æ–‡ç« [ä½¿ç”¨ React+Redux ç¼–å†™ RPG æ¸¸æˆï¼ˆç¿»è¯‘ï¼‰](https://maxiee.github.io/post/ReactRPG.md/)ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯»è€…æœ€å¥½å…·å¤‡ä¸€å®šçš„ Redux åŸºç¡€ã€‚\n\n## é¡¹ç›®æ¦‚è§ˆ\n\nä»£ç ä½äºå·¥ç¨‹çš„ src ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹è¿™ä¸ªç›®å½•ä¸‹çš„æ„æˆï¼š\n\n```\nsrc\nâ”œâ”€â”€ App.js\t\t\t\t\t\t// ä¸»åº”ç”¨\nâ”œâ”€â”€ __tests__\t\t\t\t\t// æµ‹è¯•æ–‡ä»¶\nâ”œâ”€â”€ components\t\t\t\t\t// React ç»„ä»¶\nâ”œâ”€â”€ config\nâ”‚   â”œâ”€â”€ constants.js\t\t\t// å¸¸é‡å®šä¹‰\nâ”‚   â””â”€â”€ store.js\t\t\t\t// store å®šä¹‰ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ¬ç¯‡åˆ†æçš„å…³é”®\nâ”œâ”€â”€ data\t\t\t\t\t\t// æ¸¸æˆæ•°æ®\nâ”œâ”€â”€ features\t\t\t\t\t// æ¸¸æˆè¡Œä¸ºå®šä¹‰(actionsï¼Œreducers)\nâ”œâ”€â”€ index.js\t\t\t\t\t// åº”ç”¨å…¥å£\nâ”œâ”€â”€ index.scss\nâ””â”€â”€ utils\t\t\t\t\t\t// å·¥å…·ç±»\n```\n\nå…¶ä¸­ï¼š\n\n- é¡¹ç›®çš„æ¨¡å—åˆ’åˆ†æ¯”è¾ƒæ¸…æ™°ï¼Œå€¼å¾—å­¦ä¹ \n\n- åœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å…ˆçœ‹æ•°æ®å±‚ï¼Œåçœ‹ UI å±‚ï¼Œå› æ­¤ configã€dataã€features è¿™ä¸‰ä¸ªç›®å½•æ˜¯æˆ‘ä»¬æ„Ÿå…´è¶£çš„\n\n## src/config/store.js\n\nåœ¨è¿™ä¸ªç±»ä¸­å®šä¹‰äº† Redux Storeã€‚\n\nå„ä¸ª reducer æŒ‰ç…§åŠŸèƒ½è¢«æ‹†åˆ†åˆ°ä¸åŒçš„æ¨¡å—å½“ä¸­å»ï¼š\n\n```js\nimport appState  from '../features/app-state/reducer';\nimport player    from '../features/player/reducer';\nimport dialog    from '../features/dialog-manager/reducer';\nimport map       from '../features/map/reducer';\nimport gameMenu  from '../features/game-menus/reducer';\nimport world     from '../features/world/reducer';\nimport stats     from '../features/stats/reducer';\nimport inventory from '../features/inventory/reducer';\nimport monsters  from '../features/monsters/reducer';\nimport snackbar  from '../features/snackbar/reducer';\n```\n\né€šè¿‡ combineReducers å°†å®ƒä»¬ç»„è£…èµ·æ¥ï¼š\n\n```js\nconst rootReducer = combineReducers({\n  appState,\n  player,\n  dialog,\n  gameMenu,\n  map,\n  world,\n  stats,\n  inventory,\n  monsters,\n  snackbar\n});\n```\n\nä½œè€…ä½¿ç”¨ [redux-persist](https://github.com/rt2zz/redux-persist) æ¥åšçŠ¶æ€æŒä¹…åŒ–ã€‚å®ƒä¸åœ¨æ–‡ç« çš„ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†å®ƒç•¥è¿‡ã€‚\n\næœ€åæ˜¯åˆ›å»º storeï¼Œå¹¶å°†å®ƒå¯¼å‡ºï¼š\n\n```js\nconst store = createStore(\n  persistedReducer,\n  compose(\n    applyMiddleware(thunk),\n    // this mixed operated is needed, otherwise you get a weird error from redux about applying funcs\n    // eslint-disable-next-line\n    process.env.NODE_ENV === 'development' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__() || compose\n  )\n);\n\nexport default store;\n```\n\nå…¶ä¸­ï¼š\n\n- ä½œè€…è¿˜æ·»åŠ äº†ä¸€ä¸ªä¸­é—´ä»¶ redux-thunk\n\n## Reducers\n\nä½œè€…å¯¹ Reducers çš„æ‹†åˆ†éå¸¸æ¸…æ™°ï¼Œå€¼å¾—å€Ÿé‰´ï¼š\n\n```\nfeatures\nâ”œâ”€â”€ app-state\nâ”‚   â”œâ”€â”€ actions\nâ”‚   â””â”€â”€ reducer.js\nâ”œâ”€â”€ dialog-manager\nâ”‚   â”œâ”€â”€ actions\nâ”‚   â”œâ”€â”€ dialogs\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â””â”€â”€ reducer.js\nâ”œâ”€â”€ game-menus\nâ”‚   â”œâ”€â”€ actions\nâ”‚   â”œâ”€â”€ game-music\nâ”‚   â”œâ”€â”€ game-settings\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â”œâ”€â”€ reducer.js\nâ”‚   â””â”€â”€ styles.scss\nâ”œâ”€â”€ inventory\nâ”‚   â”œâ”€â”€ actions\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â”œâ”€â”€ reducer.js\nâ”‚   â””â”€â”€ styles.scss\nâ”œâ”€â”€ map\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â”œâ”€â”€ map-padding.js\nâ”‚   â”œâ”€â”€ map-tile.js\nâ”‚   â”œâ”€â”€ random-map-gen\nâ”‚   â”œâ”€â”€ reducer.js\nâ”‚   â””â”€â”€ styles.scss\nâ€¦â€¦\n```\n\nå…¶ä¸­ï¼š\n\n- features ä¸‹æŒ‰ç…§åŠŸèƒ½è¿›è¡Œæ‹†åˆ†ï¼šæ¯”å¦‚ç‰©å“æ (inventory)ã€åœ°å›¾(map)\n- åœ¨æ¯ä¸ªå­æ¨¡å—ä¸‹ï¼š\n    - reducer.js ç››æ”¾ Redux redux\n    - actions æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®šä¹‰äº†ç›¸å…³çš„ Redux actions\n\nactions ç›®å½•ä¸‹ï¼Œæ¯ä¸ª action å•ç‹¬ä¸€ä¸ªæ–‡ä»¶ï¼š\n\n```\ninventory\nâ”œâ”€â”€ actions\nâ”‚   â”œâ”€â”€ buy-item.js\nâ”‚   â”œâ”€â”€ consume-potion.js\nâ”‚   â”œâ”€â”€ drop-item.js\nâ”‚   â”œâ”€â”€ equip-item.js\nâ”‚   â”œâ”€â”€ load-starting-items.js\nâ”‚   â”œâ”€â”€ pickup-item.js\nâ”‚   â”œâ”€â”€ sell-item.js\nâ”‚   â””â”€â”€ unequip-item.js\nâ”œâ”€â”€ index.js\nâ”œâ”€â”€ reducer.js\nâ””â”€â”€ styles.scss\n```\n\n## features/inventory\n\näº†è§£æ•°æ®ç»“æ„å°±æ˜¯äº†è§£ Redux Reducerï¼Œä¹Ÿå°±æ˜¯ features ä¸‹çš„è¿™äº›æ¨¡å—ã€‚\n\næˆ‘ä»ä¸­é€‰æ‹©äº†ä¸€ä¸ªæ¯”è¾ƒå¥½å…¥æ‰‹çš„ï¼Œå³ inventoryã€‚\n\n### åˆå§‹çŠ¶æ€\n\næˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ inventory çš„åˆå§‹çŠ¶æ€ï¼ˆä½äº reducer.jsï¼‰ï¼š\n\n```js\nconst initialState = {\n  items: [],\n  maxItems: MAX_ITEMS\n};\n```\n\nå…¶ä¸­ï¼š\n\n- items æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºç©å®¶æ‰€æŒæœ‰çš„ç‰©å“\n- maxItemsï¼šè¡¨ç¤ºç©å®¶æŒæœ‰ç‰©å“æ•°é‡çš„ä¸Šé™ï¼Œè¿™ä¸ªå€¼æ˜¯ 8\n\né€šè¿‡åˆå§‹çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ç‰©å“æ çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·ã€‚\n\n### æ¡è£…å¤‡\n\nç© Rogue-like æ¸¸æˆï¼Œæ¡è£…å¤‡æ˜¯æœ€çˆ½çš„äº‹æƒ…äº†ã€‚æˆ‘ä»¬æ¥çœ‹å¦‚ä½•ç”¨ Redux å®ç°æ¡è£…å¤‡ã€‚\n\nå®ƒçš„ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n\nexport default function pickupItem() {\n  return (dispatch, getState) => {\n\n    const { inventory, dialog } = getState();\t// è·å–è€çš„çŠ¶æ€æ ‘ä¸­å¯¹åº”å­çŠ¶æ€\n\n    const { item } = dialog.chestOpen;\t\t\t// æ˜¯å¦æ‰“å¼€å®ç®±\n\n    if(!item) return;\t\t\t\t\t\t\t// å¦‚æœå®ç®±æ²¡æ‰“å¼€ï¼Œåˆ™é€€å‡º\n\n    const { items, maxItems } = inventory;\t\t// è·å–ç‰©å“åˆ—è¡¨ä¸ä¸Šé™\n\n    if(items.length < maxItems) {\t\t\t\t// èƒ½è£…å¾—ä¸‹\n    dispatch({\t\t\t\t\t\t\t\t\t// å‘é€ä¸€ä¸ªè·å–ç‰©å“çš„ action\n        type: 'GET_ITEM',\n        payload: item\n      });\n    }\n    else {\t\t\t\t\t\t\t\t\t\t// è£…ä¸ä¸‹äº†\n      dispatch({\t\t\t\t\t\t\t\t// å‘é€ä¸€ä¸ªç‰©å“è¿‡å¤šçš„ action\n        type: 'TOO_MANY_ITEMS',\n        payload: item\n      });\n    }\n  };\n}\n```\n\nå…¶ä¸­ï¼š\n\n- `GET_ITEM` è¿™ä¸ª action type éƒ½æ˜¯åµŒå¥—åœ¨åˆ«çš„ Actions å†…éƒ¨ä½¿ç”¨çš„\n- ä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªå†…éƒ¨ä½¿ç”¨çš„ action\n\n### å¤„ç† GET ITEM\n\n`GET_ITEM` åœ¨ç‰©å“æ çš„ reducer.js çš„å†…éƒ¨è¿›è¡Œå¤„ç†ï¼Œå¯¹åº”ä»£ç ä¸ºï¼š\n\n```js\nconst inventoryReducer = (state = initialState, { type, payload }) => {\n\tlet newState;\n    switch(type) {\n    \tâ€¦â€¦\n        case 'GET_ITEM':\n            newState = _cloneDeep(state); // å¯¹åŸçŠ¶æ€è¿›è¡Œæ·±æ‹·è´ lodash.clonedeep\n            // å°†ç‰©å“åŠ å…¥ç‰©å“æ ï¼Œå…¶ä¸­ä¸ºç‰©å“æ·»åŠ ä¸€ä¸ª uuid æ ‡è¯†\n            newState.items.push({ ...payload, id: uuidv4() });\n            return newState; // è¿”å›æ–°çŠ¶æ€\n```\n\n## è£…å¤‡è£…å¤‡\n\nå½“æˆ‘ä»¬è§åˆ°ä¸€æŠŠå‰‘åï¼Œæƒ³è£…å¤‡åˆ°ç©å®¶èº«ä¸Šï¼Œæ˜¯èµ°çš„ src/features/inventory/actions/equip-item.js Actionï¼š\n\n```js\nexport default function equipItem(item) {\n  return dispatch => {\n\n    dispatch({\n      type: 'EQUIP_ITEM',\n      payload: item\n    });\n  };\n}\n```\n\nè¿™ä¸ª Actions çš„å¤„ç†è€…ä¸æ˜¯ç‰©å“æ æ¨¡å—ï¼Œè€Œæ˜¯ stats æ¨¡å—(å®ƒè¡¨ç¤ºç©å®¶å±æ€§)ï¼Œä½äº src/features/stats/reducer.jsï¼š\n\n```js\nconst statsReducer = (state = initialState, { type, payload }) => {\n\tlet newState;\n\tswitch(type) {\n\t\tcase 'EQUIP_ITEM':\n\t\t\tnewState = _cloneDeep(state);\n\t\t\tconst item = payload;\n            switch(item.type) {\n                case 'weapon':\t// è¿™é‡Œåªä»¥æ­¦å™¨ä¸ºä¾‹ï¼Œçœç•¥å…¶å®ƒç±»å‹çš„è£…å¤‡\n                    // å¦‚æœå·²ç»è£…å¤‡æœ‰æ­¦å™¨\n                    if (newState.equippedItems.weapon) {\n                        // æ‰£æ‰å®ƒçš„æ­¦å™¨ä¼¤å®³ï¼Œè¡¨ç¤ºæŠŠå®ƒçš„å±æ€§åŠ æˆä¸‹æ‰äº†\n                        newState.damage -= newState.equippedItems.weapon.damage;\n                    }\n                    // åœ¨åŠ ä¸Šæ–°æ­¦å™¨çš„å±æ€§åŠ æˆ\n                    newState.damage += item.damage;\n                    // å°†å·²è£…å¤‡çš„æ­¦å™¨æŒ‡å‘å½“å‰æ­¦å™¨\n                    newState.equippedItems.weapon = item;\n                    break;\n            \tdefault:\n      \t\t}\n            return newState;\n```\n\n## æ‰“æ€ªèµšé’±\n\nåœ¨æ¸¸æˆä¸­æ‰“æ€ªæ˜¯å¯ä»¥èµšé’±çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†æ¢ç©¶ä¸‹è¿™ä¸€è¿‡ç¨‹ã€‚\n\næˆ‘ä»¬é‡‡ç”¨è‡ªåº•å‘ä¸Šçš„æ–¹æ³•ï¼Œå…ˆæ‰¾åˆ°é‡‘é’±å­˜å‚¨åœ¨å“ªé‡Œï¼Œç­”æ¡ˆæ˜¯åœ¨ stats æ¨¡å—ä¸­ï¼Œå®ƒçš„çŠ¶æ€æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\n\n```js\nconst initialState = {\n  hp: 10,\n  maxHp: 10,\n  damage: 3,\n  defence: 0,\n  level: 1,\n  exp: 0,\n  expToLevel: 20,\n  gold: 0,\n  equippedItems: {}\n};\n```\n\nå…¶ä¸­ï¼š\n\n- gold å°±è¡¨ç¤ºé‡‘é’±(é‡‘å¸ğŸ’°)\n\nèµšé’±çš„ Action å¤„ç†çš„ä»£ç ä¸ºï¼š\n\n```js\nconst statsReducer = (state = initialState, { type, payload }) => {\n\tlet newState;\n    switch(type) {\n    \tcase 'GET_GOLD':\n            return { ...state, gold: state.gold + payload };\n```\n\nè¿™æ®µä»£ç æ˜¯éå¸¸ç®€å•çš„ï¼Œè¦æ˜¯ç°å®ä¸­èµšé’±ä¹Ÿè¿™ä¹ˆç®€å•å°±å¥½äº†ã€‚\n\nåº•å±‚åˆ†æå¥½äº†ï¼Œæˆ‘ä»¬å‘ä¸Šçœ‹ï¼šè°å‘é€ `GET_GOLD` äº‹ä»¶äº†ï¼Ÿ\n\næ‰¾åˆ°ä¸¤å¤„ï¼š\n\n1. æ‰“å¼€ç®±å­äº‹ä»¶\n2. å–å‡ºç‰©å“äº‹ä»¶\n\næˆ‘ä»¬é€‰æ‹©ç¬¬ä¸€ä¸ªæ¥çœ‹ï¼Œå¼€ç®±å­ï¼Œè¿™ä¸ª Action ä½äº src/features/dialog-manager/actions/open-chest.jsï¼š\n\n```js\nimport randomItem from '../dialogs/chest-loot/random-item';\n\nexport default function openChest() {\n  return (dispatch, getState) => {\n\n    const { level } = getState().stats;\t\t// è·å–å½“å‰åœ°ç‰¢å±‚æ•°\n    // è¿™ä¸ª boolean è¡¨ç¤ºæ˜¯å¦ä¼š roll å¾—ä¸€é”®è£…å¤‡\n    let itemDrop = false;\n    const chance = Math.floor(Math.random() * 100) + 1;\n    if(chance <= 25) {\t\t\t\t// æœ‰ 25% çš„å‡ ç‡ä¼šå¾—åˆ°ä¸€é”®è£…å¤‡\n      itemDrop = randomItem(level); // å¾—åˆ°ä»€ä¹ˆè£…å¤‡å‘¢ï¼Ÿåœ¨ randomItem ä¸­è‡ªåŠ¨ç”Ÿæˆ\n    }\n    // å¼€ç®±å­é™¤äº†å¾—ç‰©å“ï¼Œè¿˜èƒ½æ¡åˆ°é‡‘å¸ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®—æ³•\n    // è·å¾—é‡‘å¸ = (1~8) + 3 * åœ°ç‰¢å±‚æ•°\n    const gold = (Math.floor(Math.random() * 8) + 1) + (level * 3);\n    // å¼€ç®±å­è¿˜ä¼šå¾—ç»éªŒï¼Œç»éªŒå€¼æ˜¯å›ºå®šçš„\n    const exp = (level * 5) + 5;\n\n    // ä¸‹é¢å¼€å§‹åˆ†å‘äº‹ä»¶\n    dispatch({\t\t\t\t\t\t// èµšé’±äº†\n      type: 'GET_GOLD',\n      payload: gold\n    });\n    dispatch({\t\t\t\t\t\t// èµšç»éªŒäº†\n      type: 'GET_EXP',\n      payload: exp\n    });\n    dispatch({\t\t\t\t\t\t// è®¾ç½®ç®±å­å†…ç‰©å“\n      type: 'SET_CHEST_DATA',\n      payload: {\n        exp,\n        gold,\n        item: itemDrop\t\t\t\t// ï¼ˆè¿™ä¸ªç‰©å“ä¼šé€šè¿‡å…¶ä»– actions å–èµ°æ”¾è¿›ç‰©å“æ ä¸­ï¼‰\n      }\n    });\n  };\n}\n```\n\nå…¶ä¸­ï¼š\n\n- æˆ‘ä»¬çœ‹åˆ°äº† `GET_GOLD` äº‹ä»¶åˆ†å‘ï¼Œå®Œæ•´äº†æ•´ä¸ªè¿‡ç¨‹çš„åˆ†æ\n\næˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼ŒopenChest ç”±è°å‘å‡ºå‘¢ï¼Ÿè¿™é‡Œå°±æ˜¯ä»æ•°æ®å±‚å‘ UI å±‚è¿›å‘äº†ã€‚\n\næ‰¾åˆ°è§¦å‘çš„ä»£ç ä¸º src/features/dialog-manager/dialogs/chest-loot/index.jsï¼Œå®ƒæ˜¯å¼€ç®±å­æˆ–è€…æ‰“æ€ªåå¼¹å‡ºçš„å¯¹è¯æ¡†ã€‚\n\nè¿™éƒ¨åˆ†ä»£ç æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡ä¸­è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚\n\n## æ€»ç»“æ¨¡å¼\n\nå‰é¢çœ‹äº†è¿™ä¹ˆå¤š Reducerã€Actions çš„å®ç°ï¼Œä¹Ÿæ„Ÿå—åˆ°è¿™ä¸ªé¡¹ç›®æ•´ä½“çš„æ•´æ´æ€§ã€‚ä½œä¸ºå­¦ä¹ æˆåŠŸï¼Œæˆ‘ä»¬å°†è¿™ç§æ•´æ´çš„æ¶æ„æ–¹å¼æ¢³ç†ä¸‹æ¥ã€‚è¿™æ ·åœ¨æœªæ¥çš„æ–°é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½è¿›è¡Œè¿ç§»ï¼Œå†™å‡ºåŒæ ·ä¼˜é›…çš„ä»£ç ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬ä¹Ÿå°†ä»£ç æ”¾åœ¨ src ç›®å½•ä¸‹ã€‚åœ¨ src ä¸‹åˆ›å»ºä»¥ä¸‹ç›®å½•ï¼š\n\n```\nsrc\nâ”œâ”€â”€ App.js\t\t\t\t\t\t// ä¸»åº”ç”¨\nâ”œâ”€â”€ __tests__\t\t\t\t\t// æµ‹è¯•æ–‡ä»¶\nâ”œâ”€â”€ components\t\t\t\t\t// React ç»„ä»¶\nâ”œâ”€â”€ config\nâ”‚   â”œâ”€â”€ constants.js\t\t\t// å¸¸é‡å®šä¹‰\nâ”‚   â””â”€â”€ store.js\t\t\t\t// store å®šä¹‰ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ¬ç¯‡åˆ†æçš„å…³é”®\nâ”œâ”€â”€ reducers\t\t\t\t\t// æ•°æ®ç»“æ„å¤„ç†(Redux Reducers)\nâ”œâ”€â”€ index.js\t\t\t\t\t// åº”ç”¨å…¥å£\nâ”œâ”€â”€ index.scss\nâ””â”€â”€ utils\t\t\t\t\t\t// å·¥å…·ç±»\n```\n\nå…¶ä¸­ï¼š\n\n- æˆ‘å°† features æ”¹åä¸º reducersï¼Œè·Ÿ Redux çš„å‘½åæ–¹å¼ç›¸å¯¹åº”\n\nåœ¨ reducers ç›®å½•ä¸‹ï¼Œå°† APP æ‹†åˆ†ä¸ºè§£è€¦çš„æ¨¡å—ï¼Œæ¯”å¦‚ï¼š\n\n```\nreducers\nâ”œâ”€â”€ Account\nâ”‚   â”œâ”€â”€ actions\nâ”‚       â”œâ”€â”€ action1.js\nâ”‚       â”œâ”€â”€ action2.js\nâ”‚       â”œâ”€â”€ action3.js\nâ”‚   â”œâ”€â”€ reducer.js\n```\n\nå…¶ä¸­ action çš„å†™æ³•ä¸ºï¼š\n\n```js\nexport default function action1(params) {\n  return (dispatch, getState) => {\n      â€¦â€¦\n      let data = â€¦â€¦\n      dispatch({\n          type: \"MY_ACTION_NAME\",\n          payload: data\n      })\n}\n```\n\nreducer.js çš„å†™æ³•ä¸ºï¼š\n\n```js\nconst initialState = {\n  â€¦â€¦\n};\n\nconst inventoryReducer = (state = initialState, { type, payload }) => {\n\tswitch(type) {\n        case \"MY_ACTION_TYPE\":\n            â€¦â€¦\n            return newState\n        default:\n            return state\n    }\n}\n\nexport default inventoryReducer;\n```\n\nå…¶ä¸­ï¼š\n\n- éœ€è¦æ³¨æ„çš„æ˜¯ newState æ˜¯éœ€è¦æ·±æ‹·è´çš„\n\nreducers å†™å¥½åï¼Œæ¥åˆ° config/store.js ä¸‹ï¼š\n\n```js\n// å¯¼å…¥å„ä¸ª reducers\nimport appState  from '../features/app-state/reducer';\nimport player    from '../features/player/reducer';\nimport dialog    from '../features/dialog-manager/reducer';\n\n// ç»„è£…åˆ°ä¸€èµ·\nconst rootReducer = combineReducers({\n  appState,\n  player,\n  dialog,\n  gameMenu,\n  map,\n  world,\n  stats,\n  inventory,\n  monsters,\n  snackbar\n});\n\n// åˆ›å»ºå…¨å±€ store\nconst store = createStore(\n  rootReducer\n);\n\n// è¿”å›\nexport default store;\n```\n\nå…¶ä¸­:\n\n- ä»¥ appState ä¸ºä¾‹ï¼Œå®ƒåœ¨ reducer.js ä¸­ export default åç§°ä¸º appStateReducerï¼Œè€Œæˆ‘ä»¬åœ¨å¯¼å…¥æ—¶å°†å…¶å‘½åä¸º appStateï¼Œè¿™ä¸ª appState å°±æ˜¯çŠ¶æ€æ ‘ä¸­è¿™ä¸€è‡ªçŠ¶æ€æ ‘çš„åç§°\n\nåœ¨åº”ç”¨å…¥å£ä¸­ï¼ˆsrc/App.jsï¼‰å°† Redux ä¸ React ç›¸ç»“åˆï¼š\n\n```jsx\nimport { Provider }         from 'react-redux';\nimport store, { persistor } from './config/store';\n\nclass ConnectedApp extends Component {\n\n  // refresh the local storage in case the redux store structure is old\n  componentDidCatch() {\n    localStorage.clear();\n    window.location.reload();\n  }\n\n  render() {\n    return(\n      <Provider store={store}>\n        <PersistGate\n          loading={<Spinner />}\n          persistor={persistor}>\n\n          <App />\n\n        </PersistGate>\n      </Provider>\n    );\n  }\n}\n\nReactDOM.render(<ConnectedApp />, document.getElementById('react-rpg'));\n```\n\n## ç»“è®º\n\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†å¯¹ ReactRPG æ•°æ®å±‚çš„å­¦ä¹ ã€‚æˆ‘ä»ä¸­æ”¶è·å¾ˆå¤§ï¼ğŸ˜†\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},"path":"post/ReactRPG1md"}
