{"template":"/home/maxiee/Code/Blog/maxiee.github.io/src/pages/post","sharedHashesByProp":{},"data":{"post":{"name":"家庭NAS：Docker 部署 Jenkins 持续集成环境","desc":"NAS 搭建起来之后，接下来想开发一些后端服务运行在上面。对于后端应用来说，持续集成是一个很麻烦的东西，需要由自动化工具来解决。因此自然想到了 Jenkins，本文介绍如何在 OpenMediaVault 上通过 Docker 部署 Jenkins。","type":"md","link":"DockerJenkinsmd","create":"2021-01-31","filename":"DockerJenkins.md"},"content":"## 介绍\n\nNAS 搭建起来之后，接下来想开发一些后端服务运行在上面。对于后端应用来说，持续集成是一个很麻烦的东西，需要由自动化工具来解决。因此自然想到了 Jenkins，本文介绍如何在 OpenMediaVault 上通过 Docker 部署 Jenkins。\n\n## 镜像\n\n社区中有多个 Jenkins 镜像可供选择。最终选择了下载量排名第二的 `jenkins/jenkins`。\n\n之所以没选排名第一的 `jenkins` 镜像，是因为这个镜像是一个废弃镜像，已经两年多没有维护了。\n\n我选择 `jenkins/jenkins` 镜像，GitHub 首页位于[这里](https://github.com/jenkinsci/docker/blob/master/README.md)。\n\n最简单的运行方法是：\n\n```\ndocker run -p 8080:8080 -p 50000:50000 jenkins/jenkins:lts\n```\n\nJenkins 数据默认会存在 `/var/jenkins_home` 下，但是不会持久化。\n\n下面命令把数据保存在磁盘上：\n\n```\ndocker run -p 8080:8080 -p 50000:50000 -v jenkins_home:/var/jenkins_home jenkins/jenkins:lts\n```\n\n在文档中还提到了数据备份，即只要备份 `jenkins_home` 所对应的目录即可。\n\n## 实践\n\n好，理论知识学完了，下面开始实践。\n\n首先 ssh 登录到 NAS，进行镜像下载。\n\n```\ndocker pull jenkins/jenkins\n```\n\n接下来去 NAS 的 SSD 硬盘创建 `jenkins_home` 目录：\n\n```\n/srv/dev-disk-by-uuid-1b9c0013-e50e-4ba5-9f16-2e8be704b742/ssd3_bk/jenkins_home\n```\n\n创建容器：\n\n```\ndocker run -d --name jenkins -p 8081:8080 -p 50000:50000 -v /srv/dev-disk-by-uuid-1b9c0013-e50e-4ba5-9f16-2e8be704b742/ssd3_bk/jenkins_home:/var/jenkins_home jenkins/jenkins:lts\n```\n\n遇到了一个问题，是容器没有挂载目录的权限。根据 [Permission denied - /var/jenkins_home/copy_reference_file.log #177](https://github.com/jenkinsci/docker/issues/177)，解决方法是修改挂载目录的权限：\n\n```\nsudo chown 1000 volume_dir\n```\n\n之后重启容器就能跑起来了。\n\n## Jenkins 配置\n\n解锁 Jenkins：\n\n![](image/截屏2021-01-31上午1.23.21.png)\n\n初始密码存在图中目录下，直接去 SSD 中寻找。\n\n安装插件，选择推荐的就行，后续需要什么自己再装：\n\n![](image/截屏2021-01-31上午1.29.58.png)\n\n插件安装过程中：\n\n![](image/截屏2021-01-31上午1.32.23.png)\n\n创建完管理员账号后，进入 Jenkins 首页：\n\n![](image/截屏2021-01-31上午1.44.43.png)\n\n## 可选插件为空\n\n在【插件管理】中我遇到一个问题，即可选插件为空，刷不出来：\n\n![](image/截屏2021-01-31上午2.25.20.png)\n\n还是网络的问题，有三种解决方法，一种是解决网络问题，一种是更换为国内源，一种是手动上传插件。\n\n由于我对 Jenkins 插件暂时需求不强烈，先用手动上传临时对付一段时间。\n\n## 小结\n\n在 NAS 上部署 Jenkins 完成了，下一步思考的是如何将它真正用起来。\n\n## 参考资源\n\n* [安装Jenkins](https://www.jenkins.io/zh/doc/book/installing/)\n* [使用 Docker 安装 Jenkins 的最佳方式](https://www.cnblogs.com/esofar/p/11163583.html)\n* [Blue Ocean](https://www.jenkins.io/zh/doc/book/blueocean/#blue-ocean)\n* [docker volume 容器卷的那些事（二）](https://deepzz.com/post/the-docker-volumes-permissions.html)\n* [Jenkins+Docker实现部署你的Vue应用](https://juejin.cn/post/6871514139764719630)\n"},"path":"post/DockerJenkinsmd"}
